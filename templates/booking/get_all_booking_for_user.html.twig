{% extends "base.html.twig" %}

{% block title 'Voir tous mes transactions' %}

{% block body %}

<div class="container">

    <section>
        <h1>Voir tous mes transactions</h1>

        
        <table class="table">
            <thead>
                <tr>
                    <th scope="col">Nom du produit</th>
                    <th scope="col">Adresse complet du produit</th>
                    <th scope="col">Type du produit</th>
                    <th scope="col">espace du produit</th>
                    <th scope="col">Propriétaire du produit</th>
                    <th scope="col">Prix/mois du produit</th>
                    <th scope="col">Date de création de la réservation</th>
                    <th scope="col">Date du début de la réservation</th>
                    <th scope="col">Date de fin de la réservation</th>
                    <th></th>
                </tr>
            </thead>

            

            <tbody>
                {% for booking in bookings %}

                    <tr>
                        <td>{{ booking.storageSpace.title }}</td>
                        <td>
                            {{ booking.storageSpace.adresse }}
                            {{ booking.storageSpace.postalCode }}
                            {{ booking.storageSpace.city }}
                        </td>
                        <td>{{ booking.storageSpace.type }}</td>
                        <td>{{ booking.storageSpace.space }} m2</td>
                        <td>
                            {{ booking.storageSpace.owner.firstName }}
                            {{ booking.storageSpace.owner.lastName }}
                        </td>
                        <td>{{ booking.storageSpace.price }}€/mois</td>
                        <td>{{ booking.dateCreatedAt | date('d/m/Y H:i') }}</td>
                        <td>{{ booking.dateStartAt | date('d/m/Y') }}</td>

                        {% if booking.dateEndAt %}
                            <td>{{ booking.dateEndAt | date('d/m/Y') }}</td>
                        {% else %}
                               <td></td>
                        {% endif %}
                        
                        {% if booking.dateEndAt is null %}
                            <td><a href="{{ path('booking_finish', { 'id' : booking.id }) }}">Mettre fin à la réservation</td>
                        {% endif %}

                        {# 
                            si la date du jour n'ait pas égale ou n'a pas encore dépassé la date de début de la réservation, 
                            on permet la suppréssion de cette réservation,
                            passé la date, l'user ne pourra plus supprimer la réservation   
                        #}
                        {% if booking.dateStartAt > date() %}
                            <td>
                                <form method="POST" action="{{ path('booking_delete', { 'id' : booking.id }) }}" class="middle" onsubmit="return confirm('Etes-vous sur de vouloir supprimer votre réservation ?')">
                                    <input type="hidden" name="_method" value="DELETE">
                                    <input type="hidden" name="_token" value="{{ csrf_token('delete') }}">
                                    <button> Supprimer </button>
                                </form>
                            </td>
                        {% endif %}
                        
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </section>
</div>    

{% endblock body %}


